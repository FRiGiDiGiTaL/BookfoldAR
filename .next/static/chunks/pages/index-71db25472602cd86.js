(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[332],{5668:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});var a=r(7876),i=r(4232),l=r(9099);function s(){let e=(0,l.useRouter)(),[t,r]=(0,i.useState)("loading"),[s,o]=(0,i.useState)(!1),[n,c]=(0,i.useState)(""),[u,d]=(0,i.useState)(""),[m,h]=(0,i.useState)(!1),[p,f]=(0,i.useState)(!1),[g,y]=(0,i.useState)(0);(0,i.useEffect)(()=>o(!0),[]);let x=e=>Date.now()<e.expiryDate&&"active"===e.status,S=async e=>{let t=e||localStorage.getItem("userEmail");if(t)try{var a,i;let e=await fetch("/api/check-subscription",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t})});if(!e.ok){console.error("Failed to fetch subscription:",await e.text()),r("new");return}let l=await e.json();if(null==l||null==(a=l.status)?void 0:a.hasActiveSubscription){c(t),r("paid"),localStorage.setItem("userEmail",t);return}if(null==l||null==(i=l.status)?void 0:i.trialActive){c(t),r("trial"),y(l.status.trialDaysRemaining||0),localStorage.setItem("userEmail",t);return}r("expired");return}catch(e){console.error("Error checking access:",e)}let l=(()=>{try{let e=localStorage.getItem("bookfoldar_trial");return e?JSON.parse(e):null}catch(e){return console.error("Error parsing trial data:",e),localStorage.removeItem("bookfoldar_trial"),null}})();l?(c(l.email),y(Math.max(0,Math.ceil((l.expiryDate-Date.now())/864e5))),r(x(l)?"trial":"expired"),x(l)&&localStorage.setItem("userEmail",l.email)):r("new")};(0,i.useEffect)(()=>{if(s&&(S(),"true"===e.query.success)){let e=localStorage.getItem("userEmail");e&&setTimeout(()=>S(e),2e3)}},[s,e.query.success]);let v=async()=>{if(!u||!u.includes("@"))return void alert("Please enter a valid email address");h(!0);try{let e=Date.now(),t={email:u.trim().toLowerCase(),startDate:e,expiryDate:e+2592e5,status:"active"};localStorage.setItem("bookfoldar_trial",JSON.stringify(t)),localStorage.setItem("userEmail",u.trim().toLowerCase()),c(u.trim().toLowerCase()),r("trial"),y(3)}catch(e){console.error("Error starting trial:",e),alert("Failed to start trial. Please try again.")}finally{h(!1)}},w=()=>e.push("/app");return(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{children:"Welcome to BookfoldAR"}),(0,a.jsxs)("p",{children:["Status: ",t]}),"new"===t&&(0,a.jsxs)("div",{children:[(0,a.jsx)("input",{value:u,onChange:e=>d(e.target.value),placeholder:"Enter your email"}),(0,a.jsx)("button",{onClick:v,disabled:m,children:m?"Starting Trial...":"Start Trial"})]}),"trial"===t&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{children:["Trial days remaining: ",g]}),(0,a.jsx)("button",{onClick:w,children:"Access App"})]}),"paid"===t&&(0,a.jsx)("button",{onClick:w,children:"Access App"}),"expired"===t&&(0,a.jsx)("p",{children:"Your trial has expired. Please purchase access."}),(0,a.jsxs)("footer",{style:{textAlign:"center",padding:"1rem",fontSize:"0.875rem",color:"#666"},children:[(0,a.jsx)("a",{href:"/privacy",style:{margin:"0 0.5rem"},children:"Privacy Policy"})," |",(0,a.jsx)("a",{href:"/terms",style:{margin:"0 0.5rem"},children:"Terms of Service"})," |",(0,a.jsx)("a",{href:"/refund",style:{margin:"0 0.5rem"},children:"Refund Policy"})]})]})}},6760:(e,t,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return r(5668)}])},9099:(e,t,r)=>{e.exports=r(6296)}},e=>{e.O(0,[636,593,792],()=>e(e.s=6760)),_N_E=e.O()}]);